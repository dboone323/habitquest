---
name: Debug CI Pipeline

on:
  push:
    branches: [main, develop]

permissions:
  contents: read

jobs:
  debug-build:
    name: Debug Build  
    runs-on: macos-latest-large

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Environment Debug
        run: |
          echo "üîç System Information:"
          uname -a
          echo ""
          echo "üîç Xcode Information:"
          xcodebuild -version || echo "‚ùå xcodebuild not found"
          xcode-select -p || echo "‚ùå xcode-select failed"
          echo ""
          echo "üîç Available Xcode versions:"
          ls -la /Applications/ | grep -i xcode || echo "No Xcode applications found"
          echo ""
          echo "üîç Project Structure:"
          ls -la
          echo ""
          echo "üîç Xcode Project Contents:"
          ls -la *.xcodeproj/ || echo "No Xcode projects found"
          echo ""
          echo "üîç PBX File Check:"
          if [ -f "CodingReviewer.xcodeproj/project.pbxproj" ]; then
            echo "Object version: $(grep 'objectVersion' CodingReviewer.xcodeproj/project.pbxproj || echo 'not found')"
            echo "FileSystemSynchronized count: $(grep -c 'PBXFileSystemSynchronized' CodingReviewer.xcodeproj/project.pbxproj || echo '0')"
          else
            echo "‚ùå No project.pbxproj found"
          fi

      - name: Simple Build Test
        run: |
          echo "üî® Attempting simple build..."
          if [ -f "CodingReviewer.xcodeproj/project.pbxproj" ]; then
            echo "Project file exists, attempting build..."
            xcodebuild -project CodingReviewer.xcodeproj -scheme CodingReviewer -destination "platform=macOS" build
          else
            echo "‚ùå Project file missing, cannot build"
            exit 1
          fi

      - name: Scheme Debug
        run: |
          echo "üîç Available schemes:"
          xcodebuild -list || echo "‚ùå Could not list schemes"
          echo ""
          echo "üîç Shared schemes:"
          ls -la CodingReviewer.xcodeproj/xcshareddata/xcschemes/ || echo "No shared schemes found"
